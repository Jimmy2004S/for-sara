<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ðŸ’Œ Nuestra Carta</title>
  <meta name="description" content="Carta de San ValentÃ­n interactiva hecha con HTML, CSS y JS" />
  <style>
    :root {
      --bg1: #0f1020;
      --bg2: #1b103a;
      --accent: #ff3b81;
      --accent-2: #ffd1e1;
      --ink: #fdf2f8;
      --muted: #c7b8ff;
      --card: #171628cc;
      --glass: rgba(255,255,255,.08);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
      color: var(--ink);
      background: radial-gradient(1200px 800px at 20% 10%, #2b2258 0%, transparent 60%),
                  radial-gradient(1200px 800px at 80% 90%, #2b103a 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x: hidden;
    }

    /* Floating hearts layer */
    .hearts, canvas.confetti { position: fixed; inset: 0; pointer-events: none; z-index: 0; }

    /* Layout */
    .wrap {
      position: relative;
      min-height: 100dvh;
      display: grid; place-items: center; padding: 24px; z-index: 1;
    }

    .card {
      width: min(900px, 92vw);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
      overflow: hidden;
      backdrop-filter: blur(8px);
    }

    .hero { position: relative; padding: 36px 28px; }
    .hero h1 {
      margin: 0 0 8px 0; font-weight: 800; letter-spacing: .4px; font-size: clamp(28px, 5vw, 42px);
    }
    .hero p { margin: 0; opacity: .9; }

    .ribbon {
      position: absolute; inset: 0 0 auto auto; transform: translate(30%, -35%) rotate(35deg);
      background: linear-gradient(45deg, var(--accent), #ff6ea6);
      color: white; font-weight: 700; padding: 10px 60px; border-radius: 10px;
      box-shadow: 0 10px 30px rgba(255, 59, 129, .35);
    }

    .cta {
      display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px;
    }
    .btn {
      position: relative; border: 0; border-radius: 999px; padding: 14px 20px; cursor: pointer;
      background: linear-gradient(180deg, #ff6ea6, var(--accent));
      color: white; font-weight: 800; letter-spacing: .4px;
      box-shadow: 0 10px 30px rgba(255, 59, 129, .35);
      transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:hover { transform: translateY(-1px); filter: saturate(1.1); box-shadow: 0 14px 34px rgba(255, 59, 129, .45); }

    .btn.ghost {
      background: transparent; color: var(--accent-2); border: 1.4px dashed rgba(255,255,255,.28);
      box-shadow: none;
    }

    .paper {
      background: #fff9fb; color: #2b103a; border-radius: 18px; padding: 22px 20px; margin: 24px; line-height: 1.7;
      font-size: clamp(16px, 1.5vw, 18px);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.8), 0 16px 30px rgba(0,0,0,.16);
      background-image: repeating-linear-gradient(transparent 0 28px, #ffe3ef 28px 29px);
      position: relative;
    }
    .paper::before {
      content: ""; position: absolute; left: 42px; top: 0; bottom: 0; width: 2px; background: #ffd1e1aa;
    }
    .paper h2 { margin: 0 0 8px 0; font-size: clamp(20px, 3vw, 26px); }
    .paper p { margin: 0 0 12px 0; text-wrap: pretty; }

    .footer {
      display: grid; gap: 12px; padding: 0 24px 28px 24px;
    }

    .tiles { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 14px; }
    .tile {
      background: var(--glass); border: 1px solid rgba(255,255,255,.1);
      border-radius: 16px; padding: 16px; min-height: 120px; position: relative; overflow: hidden;
    }
    .tile h3 { margin: 0 0 6px 0; font-size: 18px; }
    .tile p { margin: 0; opacity: .92; }

    /* Letter gate (overlay) */
    .gate {
      position: fixed; inset: 0; display: grid; place-items: center; background: radial-gradient(60% 50% at 50% 50%, rgba(27,16,58,.6), rgba(15,16,32,.95));
      z-index: 3;
      transition: opacity .6s ease, visibility .6s ease; backdrop-filter: blur(4px);
    }
    .gate.hidden { opacity: 0; visibility: hidden; }

    .envelope {
      width: min(420px, 84vw); aspect-ratio: 4/3; position: relative; display: grid; place-items: center;
      filter: drop-shadow(0 20px 30px rgba(0,0,0,.5));
      animation: float 4s ease-in-out infinite;
    }
    @keyframes float { 50% { transform: translateY(-6px) } }

    .env-body { position: absolute; inset: 0; background: #fff0f5; border-radius: 14px; border: 2px solid #ffc1d4; }
    .env-flap { position: absolute; left: 0; right: 0; top: 0; height: 50%; background: linear-gradient(180deg, #ffd6e4, #ffc1d4); clip-path: polygon(0 0, 100% 0, 50% 100%); border-top-left-radius: 14px; border-top-right-radius: 14px; transform-origin: top; transition: transform .8s ease; }
    .seal { position: absolute; width: 74px; height: 74px; border-radius: 999px; background: radial-gradient(circle at 30% 30%, #ff5b96, var(--accent)); border: 3px solid #ffd1e1; display: grid; place-items: center; color: white; font-weight: 900; letter-spacing: .5px; box-shadow: 0 10px 20px rgba(255, 59, 129, .25); }
    .seal span { font-size: 14px; }

    .open-hint { margin-top: 18px; opacity: .9; font-weight: 600; }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .envelope { animation: none; }
      .btn, .tile, .card { transition: none !important; }
    }

    /* Typewriter */
    .type { min-height: 8lh; white-space: pre-wrap; }
    .caret { display: inline-block; width: 10px; border-bottom: 2px solid #2b103a; animation: blink 1s steps(1) infinite; }
    @keyframes blink { 50% { opacity: 0; } }

    /* Heart trail (click) */
    .trail { position: fixed; width: 12px; height: 12px; pointer-events: none; transform: translate(-50%, -50%); }
  </style>
</head>
<body>
  <!-- Floating decorative hearts -->
  <svg class="hearts" aria-hidden="true"></svg>
  <canvas class="confetti" aria-hidden="true"></canvas>

  <div class="wrap">
    <article class="card" role="region" aria-label="Carta de San ValentÃ­n">
      <header class="hero">
        <div class="ribbon">San ValentÃ­n</div>
        <h1 id="title">Para <span id="nombre">Mi Persona Favorita</span> ðŸ’–</h1>
        <p>Hecho con amor y unas cuantas lÃ­neas de cÃ³digo. Desliza y haz clic donde quieras â€” hay sorpresas.</p>
        <div class="cta">
          <button class="btn" id="btnLeer">Leer la carta</button>
          <button class="btn ghost" id="btnTema" aria-pressed="false">Cambiar tema</button>
        </div>
      </header>

      <section class="paper" aria-live="polite">
        <h2>Mi carta para ti</h2>
        <div id="texto" class="type" aria-label="Contenido de la carta"></div>
      </section>

      <footer class="footer">
        <div class="tiles">
          <div class="tile">
            <h3>Cuenta regresiva</h3>
            <p>Faltan <strong><span id="count"></span></strong> dÃ­as para nuestro prÃ³ximo plan. âœ¨</p>
          </div>
          <div class="tile">
            <h3>Mini juego</h3>
            <p>Haz clic donde sea para dejar un rastro de corazones. Si tocas 15 vecesâ€¦ Â¡confeti! ðŸŽ‰</p>
          </div>
          <div class="tile">
            <h3>Dedicatoria</h3>
            <p id="dedicatoria">Con todo mi amor, <em>â€”Tu nombre</em></p>
          </div>
        </div>
      </footer>
    </article>
  </div>

  <!-- Gate / envelope overlay -->
  <div class="gate" id="gate" role="dialog" aria-modal="true" aria-labelledby="gateTitle">
    <div class="envelope" id="env">
      <div class="env-body"></div>
      <div class="env-flap" id="flap"></div>
      <div class="seal" id="seal"><span>ðŸ’Œ</span></div>
    </div>
    <div class="open-hint" id="gateTitle">Toca para abrir tu carta</div>
  </div>

  <template id="tpl-lineas">
Â¡Hola, {nombre}!\n\nGracias por cada risa, por cada abrazo y por tu paciencia infinita.\nContigo todo es mÃ¡s bonito: hasta los lunes tienen brillo.\n\nPrometo seguir eligiÃ©ndote todos los dÃ­as, en todas las versiones de nosotros.\n\nTe amo hoy, maÃ±ana y siempre. ðŸ’˜
  </template>

  <script>
    // --- PersonalizaciÃ³n rÃ¡pida ---
    const NOMBRE = 'Amor';            // cambia esto
    const FECHA_ESPECIAL = '2025-03-01'; // prÃ³xima cita / plan (YYYY-MM-DD)
    const FIRMANTE = 'â€”Tu cÃ³mplice de aventuras';

    // Inserta nombre y firma
    document.getElementById('nombre').textContent = NOMBRE;
    document.getElementById('dedicatoria').innerHTML = `Con todo mi amor, <em>${FIRMANTE}</em>`;

    // --- Gate (sobre) ---
    const gate = document.getElementById('gate');
    const flap = document.getElementById('flap');
    const seal = document.getElementById('seal');

    function openEnvelope() {
      flap.style.transform = 'rotateX(180deg)';
      seal.style.transform = 'scale(0)';
      setTimeout(() => gate.classList.add('hidden'), 700);
      confettiBurst(180);
      startTypewriter();
    }

    gate.addEventListener('click', openEnvelope);

    // --- Typewriter ---
    const texto = document.getElementById('texto');
    const plantilla = document.getElementById('tpl-lineas').innerHTML.trim().replace('{nombre}', NOMBRE);

    function typeText(el, str, speed = 20) {
      el.textContent = '';
      let i = 0;
      function tick() {
        el.textContent += str[i] || '';
        i++;
        if (i <= str.length) requestAnimationFrame(tick);
      }
      // velocidad adaptable: cada 2 frames aÃ±ade 1 char
      let frame = 0; const raf = () => { frame++; if (frame % Math.max(1, Math.floor(60 / speed)) === 0) tick(); requestAnimationFrame(raf); };
      requestAnimationFrame(raf);
    }

    function startTypewriter(){ typeText(texto, plantilla, 40); }

    // BotÃ³n leer
    document.getElementById('btnLeer').addEventListener('click', () => {
      startTypewriter();
      confettiBurst(80);
    });

    // Tema claro/oscuro
    let dark = true;
    document.getElementById('btnTema').addEventListener('click', (e) => {
      dark = !dark; e.currentTarget.setAttribute('aria-pressed', String(!dark));
      document.body.style.background = dark
        ? 'radial-gradient(1200px 800px at 20% 10%, #2b2258 0%, transparent 60%), radial-gradient(1200px 800px at 80% 90%, #2b103a 0%, transparent 60%), linear-gradient(160deg, #0f1020, #1b103a)'
        : 'radial-gradient(1200px 800px at 20% 10%, #ffe1eb 0%, transparent 60%), radial-gradient(1200px 800px at 80% 90%, #ffe8ff 0%, transparent 60%), linear-gradient(160deg, #fff0f5, #ffe8f2)';
    });

    // --- Countdown ---
    function daysUntil(dateStr){
      const today = new Date(); today.setHours(0,0,0,0);
      const target = new Date(dateStr + 'T00:00:00');
      return Math.ceil((target - today) / (1000*60*60*24));
    }
    document.getElementById('count').textContent = Math.max(0, daysUntil(FECHA_ESPECIAL));

    // --- Click hearts & confetti trigger ---
    let clicks = 0;
    document.addEventListener('click', (e) => {
      if (e.target.closest('#gate')) return; // evita mientras gate
      clicks++;
      spawnHeart(e.clientX, e.clientY);
      if (clicks % 15 === 0) confettiBurst(220);
    });

    function spawnHeart(x, y){
      const h = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      h.setAttribute('viewBox','0 0 24 24');
      h.setAttribute('class','trail');
      h.style.left = x+'px'; h.style.top = y+'px';
      h.innerHTML = '<path d="M12 21s-7.5-4.35-9.75-8.4C.7 9.68 2.15 6 5.4 6c2.1 0 3.15 1.2 3.6 1.95C9.45 7.2 10.5 6 12.6 6c3.25 0 4.7 3.68 3.15 6.6C19.5 16.65 12 21 12 21z" fill="'+randomPink()+'" />';
      document.body.appendChild(h);
      const dy = -60 - Math.random()*30; const dx = (Math.random()-.5)*40; const rot = (Math.random()-.5)*60;
      h.animate([
        { transform: 'translate(-50%,-50%) translate(0,0) rotate(0deg)', opacity: 1 },
        { transform: `translate(-50%,-50%) translate(${dx}px, ${dy}px) rotate(${rot}deg)`, opacity: 0 }
      ], { duration: 1200, easing: 'ease-out' }).onfinish = () => h.remove();
    }

    function randomPink(){
      const shades = ['#ff3b81','#ff6ea6','#ff9ac3','#ffd1e1'];
      return shades[Math.floor(Math.random()*shades.length)];
    }

    // --- Floating background hearts ---
    const bg = document.querySelector('.hearts');
    function populateHearts(){
      const n = 26; const W = window.innerWidth; const H = window.innerHeight;
      for (let i=0;i<n;i++){
        const x = Math.random()*W; const y = Math.random()*H; const s = .6+Math.random()*1.4; const d = 8+Math.random()*10;
        const path = document.createElementNS('http://www.w3.org/2000/svg','path');
        path.setAttribute('d','M12 21s-7.5-4.35-9.75-8.4C.7 9.68 2.15 6 5.4 6c2.1 0 3.15 1.2 3.6 1.95C9.45 7.2 10.5 6 12.6 6c3.25 0 4.7 3.68 3.15 6.6C19.5 16.65 12 21 12 21z');
        path.setAttribute('fill', i%3? 'rgba(255, 105, 180, .25)':'rgba(255,255,255,.08)');
        path.style.transform = `translate(${x}px, ${y}px) scale(${s})`;
        path.style.filter = 'blur(.3px)';
        path.style.animation = `floaty ${12 + Math.random()*10}s ease-in-out ${Math.random()*-5}s infinite`;
        bg.appendChild(path);
      }
    }
    const style = document.createElement('style');
    style.textContent = `@keyframes floaty{50%{transform: translate(var(--x,0), calc(var(--y,0) - 20px)) scale(var(--s,1));opacity:.9}}`;
    document.head.appendChild(style);
    populateHearts();

    // --- Confetti ---
    const canvas = document.querySelector('canvas.confetti');
    const ctx = canvas.getContext('2d');
    const conf = []; let rafId;

    function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
    addEventListener('resize', resize); resize();

    function confettiBurst(amount=120){
      for(let i=0;i<amount;i++){
        conf.push({
          x: canvas.width/2, y: canvas.height/3,
          vx: (Math.random()*2-1)*6, vy: Math.random()*-8-2,
          g: .18 + Math.random()*.04,
          w: 6+Math.random()*6, h: 3+Math.random()*5,
          r: Math.random()*360,
          color: randomPink()
        });
      }
      if(!rafId) loop();
    }

    function loop(){
      rafId = requestAnimationFrame(loop);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.globalAlpha = 1;
      conf.forEach((p, i) => {
        p.vy += p.g; p.x += p.vx; p.y += p.vy; p.r += p.vx*2;
        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.r * Math.PI/180);
        ctx.fillStyle = p.color; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h); ctx.restore();
        if (p.y > canvas.height + 40) conf.splice(i,1);
      });
      if (conf.length === 0) { cancelAnimationFrame(rafId); rafId = null; }
    }

    // Accesibilidad: enfocar botÃ³n leer cuando abre
    window.addEventListener('load', () => {
      document.getElementById('btnLeer').focus({ preventScroll: true });
    });
  </script>
</body>
</html>
